# å•†å“å›¾ç‰‡æ˜¾ç¤ºä¿®å¤è¯´æ˜

## ğŸ¯ é—®é¢˜åˆ†æ

### é—®é¢˜1: å›¾ç‰‡è·¯å¾„é‡å¤å¤„ç†

**åŸå› **: 
- `fetchProducts` å‡½æ•°ä¸­å·²ç»æ·»åŠ äº† `/templates/` å‰ç¼€
- `processProductImages` å‡½æ•°åˆä¼šå†æ¬¡å¤„ç†è·¯å¾„
- å¯¼è‡´è·¯å¾„å¯èƒ½ä¸æ­£ç¡®

### é—®é¢˜2: ç¼ºå°‘å•†å“è¯¦ç»†å­—æ®µ

**åŸå› **:
- ä»åç«¯è·å–çš„å•†å“è®°å½•åŒ…å«å¤šä¸ªå­—æ®µï¼ˆproductDesc, brand, shippingAddressç­‰ï¼‰
- ä½†åœ¨è½¬æ¢æ—¶æ²¡æœ‰ä¿ç•™è¿™äº›å­—æ®µ
- å¯¼è‡´ç¼–è¾‘å•†å“æ—¶æ•°æ®ä¸å®Œæ•´

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ `fetchProducts` å‡½æ•° âœ…

**æ–‡ä»¶**: `src/views/MerchantDashboard.vue`

#### ä¿®å¤å‰:
```javascript
const productList = data.records.map(record => ({
  id: record.productId,
  productName: record.productName || 'æœªçŸ¥å•†å“',
  imagePath: record.productImagePath ? `/templates/${record.productImagePath}` : '',  // âŒ é‡å¤æ·»åŠ å‰ç¼€
  nowPrice: record.productPrice || 0,
  originalPrice: record.productPrice ? (record.productPrice * 1.2).toFixed(2) : 0,
  category: record.category || '-',
  salesCount: record.salesCount || 0,
  status: record.status || 'åœ¨å”®',
  createTime: record.createTime || new Date().toISOString()
}))

products.value = processProductImages(productList)
```

#### ä¿®å¤å:
```javascript
const productList = data.records.map(record => ({
  id: record.productId,
  productName: record.productName || 'æœªçŸ¥å•†å“',
  productDesc: record.productDesc || '',
  imagePath: record.productImagePath || '',  // âœ… ä¿æŒåŸå§‹è·¯å¾„ï¼Œè®©processProductImageså¤„ç†
  nowPrice: record.productPrice || 0,
  originalPrice: record.productPrice ? (record.productPrice * 1.2).toFixed(2) : 0,
  brand: record.brand || '',
  category: record.category || '-',
  salesCount: record.salesCount || 0,
  status: record.status || 'åœ¨å”®',
  shippingAddress: record.shippingAddress || '',
  createTime: record.createTime || new Date().toISOString()
}))

products.value = processProductImages(productList)
```

**æ”¹è¿›ç‚¹**:
1. âœ… ç§»é™¤æ‰‹åŠ¨æ·»åŠ  `/templates/` å‰ç¼€ï¼Œäº¤ç»™ `processProductImages` ç»Ÿä¸€å¤„ç†
2. âœ… æ·»åŠ  `productDesc` å­—æ®µï¼ˆå•†å“æè¿°ï¼‰
3. âœ… æ·»åŠ  `brand` å­—æ®µï¼ˆå“ç‰Œï¼‰
4. âœ… æ·»åŠ  `shippingAddress` å­—æ®µï¼ˆå‘è´§åœ°å€ï¼‰

---

### 2. ä¿®å¤ `imageHelper.js` âœ…

**æ–‡ä»¶**: `src/utils/imageHelper.js`

#### ä¿®å¤å‰:
```javascript
export function getImageUrl(imagePath) {
  if (!imagePath) {
    return 'https://via.placeholder.com/300x300?text=No+Image'
  }

  if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {
    return imagePath
  }

  const fileName = imagePath.split('/').pop()

  if (localImages[fileName]) {
    return localImages[fileName]
  }

  if (imagePath.startsWith('/')) {
    return imagePath
  }

  if (!imagePath.includes('/')) {
    if (localImages[imagePath]) {
      return localImages[imagePath]
    }
    return `/images/${imagePath}`
  }

  return imagePath
}
```

#### ä¿®å¤å:
```javascript
export function getImageUrl(imagePath) {
  if (!imagePath) {
    return 'https://via.placeholder.com/300x300?text=No+Image'
  }

  // å¦‚æœæ˜¯å®Œæ•´çš„HTTP/HTTPS URLï¼Œç›´æ¥è¿”å›
  if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {
    return imagePath
  }

  // å¦‚æœå·²ç»åŒ…å« /templates/ å‰ç¼€ï¼Œç›´æ¥è¿”å›
  if (imagePath.startsWith('/templates/')) {
    return imagePath
  }

  // æå–æ–‡ä»¶å
  const fileName = imagePath.split('/').pop()

  // å¦‚æœæœ¬åœ°æœ‰è¿™ä¸ªå›¾ç‰‡ï¼Œä½¿ç”¨æœ¬åœ°å›¾ç‰‡
  if (localImages[fileName]) {
    return localImages[fileName]
  }

  // åç«¯è¿”å›çš„è·¯å¾„æ ¼å¼é€šå¸¸æ˜¯: images/xxx.jpg
  // éœ€è¦æ·»åŠ  /templates/ å‰ç¼€æ¥è®¿é—®ï¼ˆå‚è€ƒåŸå§‹HTMLï¼‰
  if (imagePath.startsWith('images/')) {
    return `/templates/${imagePath}`
  }

  // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ·»åŠ  /templates/ å‰ç¼€
  if (!imagePath.startsWith('/')) {
    return `/templates/${imagePath}`
  }

  // å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ï¼Œç›´æ¥è¿”å›
  return imagePath
}
```

**æ”¹è¿›ç‚¹**:
1. âœ… æ£€æŸ¥æ˜¯å¦å·²åŒ…å« `/templates/` å‰ç¼€ï¼Œé¿å…é‡å¤æ·»åŠ 
2. âœ… å¯¹ `images/` å¼€å¤´çš„è·¯å¾„æ·»åŠ  `/templates/` å‰ç¼€
3. âœ… å¯¹ç›¸å¯¹è·¯å¾„ç»Ÿä¸€æ·»åŠ  `/templates/` å‰ç¼€
4. âœ… ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å›¾ç‰‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

---

## ğŸ“Š å›¾ç‰‡è·¯å¾„å¤„ç†é€»è¾‘

### åç«¯è¿”å›çš„è·¯å¾„æ ¼å¼

| åç«¯è¿”å› | å¤„ç†å | è¯´æ˜ |
|---------|--------|------|
| `images/1.jpg` | `/templates/images/1.jpg` | âœ… æ·»åŠ å‰ç¼€ |
| `1.jpg` | æœ¬åœ°å›¾ç‰‡URL | âœ… ä½¿ç”¨æœ¬åœ°èµ„æº |
| `/templates/images/1.jpg` | `/templates/images/1.jpg` | âœ… å·²æœ‰å‰ç¼€ï¼Œä¸é‡å¤ |
| `http://example.com/1.jpg` | `http://example.com/1.jpg` | âœ… å®Œæ•´URLï¼Œç›´æ¥ä½¿ç”¨ |
| ç©ºå­—ç¬¦ä¸² | å ä½å›¾ | âœ… æ˜¾ç¤ºé»˜è®¤å›¾ç‰‡ |

---

## ğŸ” åŸå§‹HTMLå‚è€ƒ

**æ–‡ä»¶**: `resources/templates/merchant-dashboard.html`

### å›¾ç‰‡è·¯å¾„å¤„ç†ï¼ˆç¬¬931-945è¡Œï¼‰

```javascript
const product = {
    id: record.productId,
    productName: record.productName || 'æœªçŸ¥å•†å“',
    imagePath: record.productImagePath || '',  // ä¿æŒåŸå§‹è·¯å¾„
    nowPrice: record.productPrice || 0,
    originalPrice: record.productPrice ? record.productPrice * 1.2 : 0,
    category: record.category || '-',
    salesCount: record.salesCount || 0,
    status: record.status || 'åœ¨å”®',
    createTime: record.createTime || new Date().toISOString()
};

// æ˜¾ç¤ºå›¾ç‰‡æ—¶æ·»åŠ  /templates/ å‰ç¼€
row.innerHTML = `
    <td>${product.id}</td>
    <td><img src="/templates/${product.imagePath}" alt="${product.productName}" class="product-image"></td>
    ...
`;
```

**å…³é”®ç‚¹**:
- âœ… åç«¯è¿”å›çš„æ˜¯ `record.productImagePath`ï¼ˆå¦‚ `images/1.jpg`ï¼‰
- âœ… æ˜¾ç¤ºæ—¶æ·»åŠ  `/templates/` å‰ç¼€
- âœ… æœ€ç»ˆè·¯å¾„: `/templates/images/1.jpg`

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1: åç«¯è¿”å› `images/1.jpg`

1. **åç«¯å“åº”**:
   ```json
   {
     "productImagePath": "images/1.jpg"
   }
   ```

2. **å¤„ç†æµç¨‹**:
   ```
   images/1.jpg
   â†’ getImageUrl('images/1.jpg')
   â†’ æ£€æµ‹åˆ° images/ å¼€å¤´
   â†’ è¿”å› /templates/images/1.jpg
   ```

3. **æœ€ç»ˆæ˜¾ç¤º**:
   ```html
   <img src="/templates/images/1.jpg" alt="å•†å“åç§°" />
   ```

---

### åœºæ™¯2: æœ¬åœ°å›¾ç‰‡ `1.jpg`

1. **åç«¯å“åº”**:
   ```json
   {
     "productImagePath": "1.jpg"
   }
   ```

2. **å¤„ç†æµç¨‹**:
   ```
   1.jpg
   â†’ getImageUrl('1.jpg')
   â†’ æ£€æµ‹åˆ°æœ¬åœ°æœ‰æ­¤å›¾ç‰‡
   â†’ è¿”å›æœ¬åœ°å›¾ç‰‡URL
   ```

3. **æœ€ç»ˆæ˜¾ç¤º**:
   ```html
   <img src="blob:http://localhost:3000/xxx" alt="å•†å“åç§°" />
   ```

---

### åœºæ™¯3: æ–°ä¸Šä¼ çš„å›¾ç‰‡

1. **ä¸Šä¼ ååç«¯è¿”å›**:
   ```json
   {
     "productImagePath": "images/upload_123456.jpg"
   }
   ```

2. **å¤„ç†æµç¨‹**:
   ```
   images/upload_123456.jpg
   â†’ getImageUrl('images/upload_123456.jpg')
   â†’ æ£€æµ‹åˆ° images/ å¼€å¤´
   â†’ è¿”å› /templates/images/upload_123456.jpg
   ```

3. **æœ€ç»ˆæ˜¾ç¤º**:
   ```html
   <img src="/templates/images/upload_123456.jpg" alt="å•†å“åç§°" />
   ```

---

## âœ… éªŒæ”¶æ ‡å‡†

### å•†å“åˆ—è¡¨æ˜¾ç¤º

- [x] å›¾ç‰‡è·¯å¾„æ­£ç¡®å¤„ç†
- [x] æœ¬åœ°å›¾ç‰‡ä¼˜å…ˆä½¿ç”¨
- [x] åç«¯å›¾ç‰‡æ­£ç¡®æ˜¾ç¤º
- [x] ç©ºå›¾ç‰‡æ˜¾ç¤ºå ä½ç¬¦
- [x] ä¸é‡å¤æ·»åŠ  `/templates/` å‰ç¼€

### å•†å“ç¼–è¾‘

- [x] ç¼–è¾‘æ—¶æ˜¾ç¤ºå½“å‰å›¾ç‰‡
- [x] å•†å“æè¿°æ­£ç¡®æ˜¾ç¤º
- [x] å“ç‰Œä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [x] å‘è´§åœ°å€æ­£ç¡®æ˜¾ç¤º
- [x] æ‰€æœ‰å­—æ®µå®Œæ•´ä¿ç•™

---

## ğŸ¯ å…³é”®æ”¹è¿›

1. âœ… **ç»Ÿä¸€å›¾ç‰‡è·¯å¾„å¤„ç†**: æ‰€æœ‰å›¾ç‰‡è·¯å¾„ç”± `imageHelper.js` ç»Ÿä¸€å¤„ç†
2. âœ… **é¿å…é‡å¤å‰ç¼€**: æ£€æŸ¥æ˜¯å¦å·²æœ‰ `/templates/` å‰ç¼€
3. âœ… **å®Œæ•´å­—æ®µæ˜ å°„**: ä¿ç•™æ‰€æœ‰å•†å“å­—æ®µï¼ˆproductDesc, brand, shippingAddressï¼‰
4. âœ… **æœ¬åœ°å›¾ç‰‡ä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨æœ¬åœ°èµ„æºï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚
5. âœ… **ç¬¦åˆåŸå§‹é€»è¾‘**: å®Œå…¨æŒ‰ç…§åŸå§‹HTMLçš„å¤„ç†æ–¹å¼

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-15
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: â³ å¾…ç”¨æˆ·æµ‹è¯•

**è¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹å•†å“åˆ—è¡¨ï¼Œæ£€æŸ¥å›¾ç‰‡æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºï¼** ğŸ–¼ï¸

