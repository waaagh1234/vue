<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜索结果 - 优品商城</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="/css/search-results.css">
    <style>
        .search-results-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .search-header {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 5px;
        }

        .search-header h2 {
            margin: 0;
            color: #333;
        }

        .search-header .search-term {
            color: #e4393c;
            font-weight: bold;
        }

        .results-count {
            color: #666;
            margin-top: 5px;
        }

        .filter-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 5px;
        }

        .filter-options {
            display: flex;
            gap: 15px;
        }

        .filter-options select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 5px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-image {
            position: relative;
            padding-top: 100%;
            overflow: hidden;
        }

        .product-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-price {
            color: #e4393c;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }

        .product-price .price-original {
            color: #999;
            text-decoration: line-through;
            font-size: 14px;
            margin-left: 10px;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .sales {
            color: #999;
            font-size: 12px;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .actions i {
            cursor: pointer;
            color: #666;
            transition: color 0.3s ease;
        }

        .actions i:hover {
            color: #e4393c;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 10px;
        }

        .pagination a {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            color: #333;
            text-decoration: none;
        }

        .pagination a.active {
            background: #e4393c;
            color: #fff;
            border-color: #e4393c;
        }
    </style>
</head>
<body>
<!-- 顶部导航 -->
<div class="site-nav">
    <div class="container">
        <div class="nav-left">
            <span class="welcome">欢迎来到优品商城！</span>
        </div>
        <div class="nav-right">
            <a href="records.html"><i class="fas fa-user"></i> 我的订单</a>
            <a href="cart.html"><i class="fas fa-shopping-cart"></i> 购物车</a>
            <a href="favorites.html"><i class="fas fa-star"></i> 收藏夹</a>
<!--            <a href="#"><i class="fas fa-mobile-alt"></i> 手机版</a>-->
            <a href="help.html"><i class="fas fa-question-circle"></i> 帮助中心</a>
        </div>
    </div>
</div>

<!-- 头部搜索区 -->
<div class="header">
    <div class="container">
        <div class="logo">
            <h1>优品商城</h1>
        </div>
        <div class="search-box">
            <div class="search-input">
                <input type="text" id="searchInput" placeholder="请输入要搜索的商品">
                <button class="search-btn" onclick="submitSearch()">搜索</button>
            </div>
        </div>
<!--        <div class="cart-box">-->
<!--            <i class="fas fa-shopping-cart"></i>-->
<!--            <span>购物车</span>-->
<!--        </div>-->
    </div>
</div>

<!-- 搜索结果区 -->
<div class="search-results-container">
    <div class="search-header">
        <h2>搜索 "<span class="search-term" id="searchTerm"></span>" 的结果</h2>
        <div class="results-count">找到 <span id="resultsCount">0</span> 个商品</div>
    </div>

    <div class="filter-section">
        <div class="filter-options">
            <select>
                <option>综合排序</option>
                <option>价格从低到高</option>
                <option>价格从高到低</option>
                <option>销量优先</option>
            </select>
            <select>
                <option>全部商品</option>
                <option>仅看有货</option>
            </select>
        </div>
    </div>

    <div class="product-grid" id="productGrid">
        <!-- 商品卡片将通过JavaScript动态添加 -->
    </div>

    <div class="pagination">
        <a href="#" class="active">1</a>
        <a href="#">2</a>
        <a href="#">3</a>
        <a href="#">4</a>
        <a href="#">5</a>
        <a href="#">下一页</a>
    </div>
</div>


    <!-- 省略其他头部信息 -->
<script>
    // 从URL获取搜索关键词
    const urlParams = new URLSearchParams(window.location.search);
    const searchTerm = urlParams.get('q');

    // 更新页面上的搜索关键词
    document.getElementById('searchTerm').textContent = searchTerm;

    // 调用后端接口获取搜索结果
    async function getSearchResults() {
        try {
            const response = await fetch('http://localhost:8080/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(searchTerm)  // 直接发送搜索关键词字符串
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const products = await response.json();
            const productGrid = document.getElementById('productGrid');
            document.getElementById('resultsCount').textContent = products.length;

            products.forEach(product => {
                const card = document.createElement('div');
                card.classList.add('product-card');
                card.innerHTML = `
                        <div class="product-image">
                            <img src="${product.imagePath}" alt="${product.productName}">
                        </div>
                        <div class="product-info">
                            <div class="product-name">${product.productName}</div>
                            <div class="product-price">
                                <span class="price-now">¥${product.nowPrice}</span>
                                <span class="price-original">¥${product.originalPrice}</span>
                            </div>
                            <div class="product-footer">
                                <span class="sales">已售${product.salesCount}件</span>
                                <div class="actions">
                                    <i class="fas fa-heart"></i>
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                            </div>
                        </div>
                    `;
                // 添加点击事件，跳转到商品详情页面
                card.addEventListener('click', () => {
                    window.location.href = `product-detail.html?id=${product.id}`;
                });
                productGrid.appendChild(card);
            });
        } catch (error) {
            console.error('请求出错:', error);
            alert('搜索请求出现错误，请稍后重试');
        }
    }

    // 页面加载完成后调用获取搜索结果的函数
    if (searchTerm) {
        getSearchResults();
    }

    // 搜索功能
    function submitSearch() {
        const input = document.getElementById('searchInput');
        const searchValue = input.value;
        window.location.href = `search-results.html?q=${encodeURIComponent(searchValue)}`;
    }
</script>
</body>
</html>