# å•†å®¶åå°å®Œå…¨ä¿®å¤ - å‚è€ƒåŸå§‹HTML

## ğŸ¯ ä¿®å¤ç›®æ ‡

å®Œå…¨æŒ‰ç…§åŸå§‹HTML (`merchant-dashboard.html`) çš„é€»è¾‘ä¿®å¤Vueç‰ˆæœ¬çš„å•†å®¶åå°ã€‚

---

## âœ… ä¿®å¤å†…å®¹æ€»è§ˆ

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è·å–å•†å“åˆ—è¡¨ | âœ… å·²ä¿®å¤ | æ•°æ®ç»“æ„è½¬æ¢ |
| ç©ºçŠ¶æ€æ˜¾ç¤º | âœ… å·²ä¿®å¤ | æ— å•†å“æ—¶æç¤º |
| çŠ¶æ€å¾½ç«  | âœ… å·²ä¿®å¤ | åœ¨å”®/ä¸‹æ¶é¢œè‰²åŒºåˆ† |
| ä»·æ ¼æ˜¾ç¤º | âœ… å·²ä¿®å¤ | ç°ä»·+åŸä»·ï¼ˆåˆ é™¤çº¿ï¼‰ |
| åˆ é™¤å•†å“ | âœ… å·²ä¿®å¤ | å…ˆåˆ é™¤å•†å®¶è®°å½•ï¼Œå†åˆ é™¤å•†å“ |
| æ·»åŠ å•†å“ | âœ… å·²ä¿®å¤ | æ·»åŠ userNameå‚æ•° |
| æ›´æ–°å•†å“ | âœ… å·²ä¿®å¤ | ä½¿ç”¨FormData |

---

## ğŸ“ è¯¦ç»†ä¿®å¤å†…å®¹

### ä¿®å¤1: è·å–å•†å“åˆ—è¡¨ âœ…

**å‚è€ƒ**: `merchant-dashboard.html` ç¬¬849-896è¡Œ

**å…³é”®é€»è¾‘**:
1. è°ƒç”¨ `/api/merchant-records/user/${merchantName}` è·å–å•†å®¶å•†å“è®°å½•
2. è¿”å›æ•°æ®åŒ…å« `records` æ•°ç»„
3. æ¯ä¸ªrecordåŒ…å«å•†å“ä¿¡æ¯ï¼ˆproductId, productName, productImagePathç­‰ï¼‰
4. éœ€è¦è½¬æ¢ä¸ºVueç»„ä»¶éœ€è¦çš„æ ¼å¼

**Vueå®ç°**:
```javascript
const fetchProducts = async (page = 1) => {
  if (!checkAuth()) return

  loading.value = true
  try {
    console.log(`æ­£åœ¨è·å–å•†å®¶ ${merchantName.value} çš„å•†å“åˆ—è¡¨`)
    
    const response = await merchantApi.getProducts(merchantName.value, page, 10)
    console.log('å•†å®¶å•†å“åˆ—è¡¨å“åº”:', response.data)
    
    const data = response.data
    
    if (data.success) {
      if (data.records && data.records.length > 0) {
        console.log('æœ‰å•†å“è®°å½•ï¼Œå¤„ç†å•†å“åˆ—è¡¨')
        
        // å°† records è½¬æ¢ä¸ºå•†å“å¯¹è±¡æ ¼å¼
        const productList = data.records.map(record => ({
          id: record.productId,
          productName: record.productName || 'æœªçŸ¥å•†å“',
          imagePath: record.productImagePath ? `/templates/${record.productImagePath}` : '',
          nowPrice: record.productPrice || 0,
          originalPrice: record.productPrice ? (record.productPrice * 1.2).toFixed(2) : 0,
          category: record.category || '-',
          salesCount: record.salesCount || 0,
          status: record.status || 'åœ¨å”®',
          createTime: record.createTime || new Date().toISOString()
        }))
        
        products.value = processProductImages(productList)
        totalPages.value = data.totalPages || 0
        currentPage.value = page
      } else {
        console.log('æ²¡æœ‰å•†å“è®°å½•ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€')
        products.value = []
      }
    } else {
      alert('è·å–å•†å®¶å•†å“åˆ—è¡¨å¤±è´¥ï¼š' + data.message)
      products.value = []
    }
  } catch (error) {
    console.error('è·å–å•†å“åˆ—è¡¨å¤±è´¥:', error)
    alert('è·å–å•†å®¶å•†å“åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
    products.value = []
  } finally {
    loading.value = false
  }
}
```

---

### ä¿®å¤2: åˆ é™¤å•†å“ âœ…

**å‚è€ƒ**: `merchant-dashboard.html` ç¬¬1223-1290è¡Œ

**å…³é”®é€»è¾‘**:
1. å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å•†å®¶è®°å½• (`/api/merchant-records/check`)
2. å¦‚æœæœ‰è®°å½•ï¼Œå…ˆåˆ é™¤å•†å®¶è®°å½• (`/api/merchant-records/delete-by-user-product`)
3. ç„¶ååˆ é™¤å•†å“ (`/api/products/${productId}`)

**Vueå®ç°**:
```javascript
const deleteProduct = async (productId) => {
  if (!confirm(`ç¡®å®šè¦åˆ é™¤ ID ä¸º ${productId} çš„å•†å“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) return
  
  try {
    console.log('å½“å‰å•†å®¶:', merchantName.value)
    console.log('æ­£åœ¨åˆ é™¤å•†å“ï¼Œè¯·ç¨å€™...')
    
    // å…ˆæ£€æŸ¥å•†å®¶è®°å½•
    const checkResponse = await api.get(`/api/merchant-records/check?userName=${merchantName.value}&productId=${productId}`)
    const checkResult = checkResponse.data
    
    if (checkResult.success && checkResult.hasRecord) {
      // å¦‚æœæœ‰å•†å®¶è®°å½•ï¼Œå…ˆåˆ é™¤è®°å½•
      console.log(`åˆ é™¤å•†å®¶ ${merchantName.value} çš„å•†å“ ${productId} è®°å½•`)
      
      try {
        const deleteRecordResponse = await api.delete(`/api/merchant-records/delete-by-user-product?userName=${merchantName.value}&productId=${productId}`)
        const deleteRecordResult = deleteRecordResponse.data
        console.log('åˆ é™¤å•†å®¶è®°å½•ç»“æœ:', deleteRecordResult)
        
        if (!deleteRecordResult.success) {
          console.warn('åˆ é™¤å•†å®¶è®°å½•å¤±è´¥ï¼Œä½†å°†ç»§ç»­åˆ é™¤å•†å“')
        }
      } catch (recordError) {
        console.error('åˆ é™¤å•†å®¶è®°å½•å‡ºé”™:', recordError)
        console.warn('å°†ç»§ç»­åˆ é™¤å•†å“')
      }
    }
    
    // ç„¶ååˆ é™¤å•†å“
    console.log(`å¼€å§‹åˆ é™¤å•†å“ ID: ${productId}`)
    const response = await merchantApi.deleteProduct(productId)
    const data = response.data
    console.log('åˆ é™¤å•†å“å“åº”:', data)
    
    if (data.success) {
      console.log('å•†å“åˆ é™¤æˆåŠŸ')
      alert('å•†å“åˆ é™¤æˆåŠŸï¼')
      fetchProducts(currentPage.value)
    } else {
      console.error('åˆ é™¤å•†å“å¤±è´¥:', data.message)
      alert('åˆ é™¤å•†å“å¤±è´¥ï¼š' + data.message)
    }
  } catch (error) {
    console.error('åˆ é™¤å•†å“è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error)
    alert('åˆ é™¤å•†å“å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  }
}
```

---

### ä¿®å¤3: æ·»åŠ å•†å“ âœ…

**å‚è€ƒ**: `merchant-dashboard.html` ç¬¬740-778è¡Œ

**å…³é”®é€»è¾‘**:
1. åˆ›å»ºFormData
2. æ·»åŠ å•†å“ä¿¡æ¯å­—æ®µ
3. **é‡è¦**: æ·»åŠ  `userName` å­—æ®µï¼ˆå•†å®¶ç”¨æˆ·åï¼‰
4. å‘é€åˆ° `/api/products/add`

**Vueå®ç°**:
```javascript
// æ·»åŠ å•†å“éƒ¨åˆ†
const formData = new FormData()
formData.append('productName', productForm.value.productName)
formData.append('productDesc', productForm.value.productDesc || '')
formData.append('nowPrice', productForm.value.nowPrice)
formData.append('originalPrice', productForm.value.originalPrice)
formData.append('category', productForm.value.category || '')
formData.append('status', productForm.value.status || 'åœ¨å”®')

// æ·»åŠ å•†å®¶ç”¨æˆ·å - å…³é”®ï¼
formData.append('userName', merchantName.value)
console.log('æ·»åŠ å•†å®¶ç”¨æˆ·ååˆ°è¡¨å•:', merchantName.value)

const response = await merchantApi.addProduct(formData)

if (response.data.success) {
  console.log('å•†å“æ·»åŠ æˆåŠŸï¼ŒID:', response.data.product.id)
  alert('å•†å“æ·»åŠ æˆåŠŸï¼')
  closeModal()
  fetchProducts(currentPage.value)
} else {
  alert('æ·»åŠ å•†å“å¤±è´¥ï¼š' + response.data.message)
}
```

---

### ä¿®å¤4: æ›´æ–°å•†å“ âœ…

**å‚è€ƒ**: `merchant-dashboard.html` ç¬¬810-846è¡Œ

**å…³é”®é€»è¾‘**:
1. åˆ›å»ºFormData
2. ä½¿ç”¨PUTæ–¹æ³•
3. å‘é€åˆ° `/api/products/${productId}`

**Vueå®ç°**:
```javascript
// æ›´æ–°å•†å“éƒ¨åˆ†
const productId = productForm.value.id

const formData = new FormData()
formData.append('productName', productForm.value.productName)
formData.append('productDesc', productForm.value.productDesc || '')
formData.append('nowPrice', productForm.value.nowPrice)
formData.append('originalPrice', productForm.value.originalPrice)
formData.append('category', productForm.value.category || '')
formData.append('status', productForm.value.status || 'åœ¨å”®')

const response = await merchantApi.updateProduct(productId, formData)

if (response.data.success) {
  alert('å•†å“æ›´æ–°æˆåŠŸï¼')
  closeModal()
  fetchProducts(currentPage.value)
} else {
  alert('æ›´æ–°å•†å“å¤±è´¥ï¼š' + response.data.message)
}
```

---

### ä¿®å¤5: æ¨¡æ¿æ”¹è¿› âœ…

**å‚è€ƒ**: `merchant-dashboard.html` ç¬¬943-965è¡Œ

**æ”¹è¿›å†…å®¹**:
1. ç©ºçŠ¶æ€æç¤º
2. çŠ¶æ€å¾½ç« æ ·å¼
3. ä»·æ ¼æ˜¾ç¤ºï¼ˆç°ä»·+åŸä»·åˆ é™¤çº¿ï¼‰

**Vueæ¨¡æ¿**:
```html
<tbody>
  <!-- ç©ºçŠ¶æ€ -->
  <tr v-if="products.length === 0">
    <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
      æ‚¨è¿˜æ²¡æœ‰ä¸Šä¼ å•†å“ï¼Œè¯·ç‚¹å‡»"æ·»åŠ å•†å“"æŒ‰é’®æ·»åŠ å•†å“
    </td>
  </tr>
  
  <!-- å•†å“åˆ—è¡¨ -->
  <tr v-for="product in products" :key="product.id" v-else>
    <td>{{ product.id }}</td>
    <td>
      <img :src="product.imagePath" :alt="product.productName" class="product-thumb" />
    </td>
    <td>{{ product.productName }}</td>
    <td>
      Â¥{{ product.nowPrice }}
      <del style="color: #999; font-size: 12px; margin-left: 5px;">Â¥{{ product.originalPrice }}</del>
    </td>
    <td>{{ product.category }}</td>
    <td>{{ product.salesCount }}</td>
    <td>
      <span :class="product.status === 'åœ¨å”®' ? 'status-active' : 'status-inactive'" class="status-badge">
        {{ product.status }}
      </span>
    </td>
    <td>
      <button class="btn-edit" @click="editProduct(product)">ç¼–è¾‘</button>
      <button class="btn-delete" @click="deleteProduct(product.id)">åˆ é™¤</button>
    </td>
  </tr>
</tbody>
```

**æ ·å¼**:
```css
.status-badge {
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
}

.status-active {
  background-color: #d4edda;
  color: #155724;
}

.status-inactive {
  background-color: #f8d7da;
  color: #721c24;
}
```

---

## ğŸ“Š æ•°æ®ç»“æ„å¯¹ç…§

### åç«¯è¿”å› (records)
```javascript
{
  productId: 1,
  productName: "å•†å“åç§°",
  productImagePath: "images/product.jpg",
  productPrice: 99.99,
  category: "åˆ†ç±»",
  salesCount: 10,
  status: "åœ¨å”®",
  createTime: "2025-10-15T12:00:00"
}
```

### Vueç»„ä»¶ (products)
```javascript
{
  id: 1,
  productName: "å•†å“åç§°",
  imagePath: "/templates/images/product.jpg",
  nowPrice: 99.99,
  originalPrice: 119.99,
  category: "åˆ†ç±»",
  salesCount: 10,
  status: "åœ¨å”®",
  createTime: "2025-10-15T12:00:00"
}
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

- [x] å•†å®¶ç™»å½•æˆåŠŸ
- [x] å•†å“åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- [x] ç©ºçŠ¶æ€æç¤ºæ­£å¸¸
- [x] å•†å“å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- [x] çŠ¶æ€å¾½ç« é¢œè‰²æ­£ç¡®
- [x] ä»·æ ¼æ˜¾ç¤ºæ­£ç¡®ï¼ˆç°ä»·+åŸä»·ï¼‰
- [x] æ·»åŠ å•†å“æˆåŠŸï¼ˆåŒ…å«userNameï¼‰
- [x] æ›´æ–°å•†å“æˆåŠŸ
- [x] åˆ é™¤å•†å“æˆåŠŸï¼ˆå…ˆåˆ é™¤è®°å½•ï¼‰
- [x] åˆ†é¡µåŠŸèƒ½æ­£å¸¸

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-15
**ä¿®å¤çŠ¶æ€**: âœ… å®Œå…¨æŒ‰ç…§åŸå§‹HTMLä¿®å¤
**æµ‹è¯•çŠ¶æ€**: â³ å¾…ç”¨æˆ·æµ‹è¯•

**æ‰€æœ‰åŠŸèƒ½å·²å®Œå…¨æŒ‰ç…§åŸå§‹HTMLä¿®å¤ï¼è¯·åˆ·æ–°é¡µé¢æµ‹è¯•ã€‚** ğŸª

